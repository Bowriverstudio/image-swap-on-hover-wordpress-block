{"version":3,"sources":["@wordpress/block-library/src/gallery/gallery-image.native.js"],"names":["compose","StyleSheet","separatorStyle","style","separator","borderRightWidth","hairlineWidth","buttonStyle","button","aspectRatio","removeButtonStyle","removeButton","ICON_SIZE_ARROW","ICON_SIZE_REMOVE","GalleryImage","arguments","onSelectImage","bind","onSelectCaption","onMediaPressed","onCaptionChange","bindContainer","updateMediaProgress","finishMediaUploadWithSuccess","finishMediaUploadWithFailure","renderContent","state","captionSelected","isUploadInProgress","didUploadFail","ref","container","setState","props","isSelected","onSelect","id","url","isBlockSelected","onSelectBlock","caption","setAttributes","prevProps","image","source_url","alt","alt_text","payload","mediaServerId","mediaUrl","params","isFirstItem","isLastItem","onRemove","onMoveForward","onMoveBackward","ariaLabel","isCropped","getStylesFromColorScheme","isUploadFailed","retryMessage","resizeMode","imageStyle","imageUploading","undefined","overlayStyle","overlay","overlaySelected","captionPlaceholderStyle","captionPlaceholder","captionPlaceholderDark","shouldShowCaptionEditable","shouldShowCaptionExpanded","captionContainerStyle","captionExpandedContainer","captionContainer","captionStyle","captionExpanded","captionDark","uri","uploadFailedContainer","uploadFailed","uploadFailedIcon","uploadFailedText","toolbar","moverButtonContainer","color","containerStyle","galleryImageContainer","galleryImageContainerDark","accessibilityLabelImageContainer","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tImage,\n\tStyleSheet,\n\tView,\n\tScrollView,\n\tText,\n\tTouchableWithoutFeedback,\n} from 'react-native';\nimport {\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n} from 'react-native-gutenberg-bridge';\nimport { isEmpty } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { Icon } from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Caption, MediaUploadProgress } from '@wordpress/block-editor';\nimport { isURL } from '@wordpress/url';\nimport { withPreferredColorScheme } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport Button from './gallery-button';\nimport style from './gallery-image-style.scss';\n\nconst { compose } = StyleSheet;\n\nconst separatorStyle = compose( style.separator, {\n\tborderRightWidth: StyleSheet.hairlineWidth,\n} );\nconst buttonStyle = compose( style.button, { aspectRatio: 1 } );\nconst removeButtonStyle = compose( style.removeButton, { aspectRatio: 1 } );\nconst ICON_SIZE_ARROW = 15;\nconst ICON_SIZE_REMOVE = 20;\n\nclass GalleryImage extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onSelectImage = this.onSelectImage.bind( this );\n\t\tthis.onSelectCaption = this.onSelectCaption.bind( this );\n\t\tthis.onMediaPressed = this.onMediaPressed.bind( this );\n\t\tthis.onCaptionChange = this.onCaptionChange.bind( this );\n\t\tthis.bindContainer = this.bindContainer.bind( this );\n\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.finishMediaUploadWithSuccess = this.finishMediaUploadWithSuccess.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.finishMediaUploadWithFailure = this.finishMediaUploadWithFailure.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.renderContent = this.renderContent.bind( this );\n\n\t\tthis.state = {\n\t\t\tcaptionSelected: false,\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: false,\n\t\t};\n\t}\n\n\tbindContainer( ref ) {\n\t\tthis.container = ref;\n\t}\n\n\tonSelectCaption() {\n\t\tif ( ! this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: true,\n\t\t\t} );\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\t}\n\n\tonMediaPressed() {\n\t\tconst { id, url } = this.props;\n\n\t\tthis.onSelectImage();\n\n\t\tif ( this.state.isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( id );\n\t\t} else if ( this.state.didUploadFail || ( id && ! isURL( url ) ) ) {\n\t\t\trequestImageFailedRetryDialog( id );\n\t\t}\n\t}\n\n\tonSelectImage() {\n\t\tif ( ! this.props.isBlockSelected ) {\n\t\t\tthis.props.onSelectBlock();\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\n\t\tif ( this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonCaptionChange( caption ) {\n\t\tconst { setAttributes } = this.props;\n\t\tsetAttributes( { caption } );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { isSelected, image, url } = this.props;\n\t\tif ( image && ! url ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: image.source_url,\n\t\t\t\talt: image.alt_text,\n\t\t\t} );\n\t\t}\n\n\t\t// unselect the caption so when the user selects other image and comeback\n\t\t// the caption is not immediately selected\n\t\tif (\n\t\t\tthis.state.captionSelected &&\n\t\t\t! isSelected &&\n\t\t\tprevProps.isSelected\n\t\t) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tupdateMediaProgress() {\n\t\tif ( ! this.state.isUploadInProgress ) {\n\t\t\tthis.setState( { isUploadInProgress: true } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tthis.setState( {\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: false,\n\t\t} );\n\n\t\tthis.props.setAttributes( {\n\t\t\tid: payload.mediaServerId,\n\t\t\turl: payload.mediaUrl,\n\t\t} );\n\t}\n\n\tfinishMediaUploadWithFailure() {\n\t\tthis.setState( {\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: true,\n\t\t} );\n\t}\n\n\trenderContent( params ) {\n\t\tconst {\n\t\t\turl,\n\t\t\tisFirstItem,\n\t\t\tisLastItem,\n\t\t\tisSelected,\n\t\t\tcaption,\n\t\t\tonRemove,\n\t\t\tonMoveForward,\n\t\t\tonMoveBackward,\n\t\t\t'aria-label': ariaLabel,\n\t\t\tisCropped,\n\t\t\tgetStylesFromColorScheme,\n\t\t} = this.props;\n\n\t\tconst { isUploadInProgress, captionSelected } = this.state;\n\t\tconst { isUploadFailed, retryMessage } = params;\n\t\tconst resizeMode = isCropped ? 'cover' : 'contain';\n\n\t\tconst imageStyle = [\n\t\t\tstyle.image,\n\t\t\t{ resizeMode },\n\t\t\tisUploadInProgress ? style.imageUploading : undefined,\n\t\t];\n\n\t\tconst overlayStyle = compose(\n\t\t\tstyle.overlay,\n\t\t\tisSelected ? style.overlaySelected : undefined\n\t\t);\n\n\t\tconst captionPlaceholderStyle = getStylesFromColorScheme(\n\t\t\tstyle.captionPlaceholder,\n\t\t\tstyle.captionPlaceholderDark\n\t\t);\n\n\t\tconst shouldShowCaptionEditable = ! isUploadFailed && isSelected;\n\t\tconst shouldShowCaptionExpanded =\n\t\t\t! isUploadFailed && ! isSelected && !! caption;\n\n\t\tconst captionContainerStyle = shouldShowCaptionExpanded\n\t\t\t? style.captionExpandedContainer\n\t\t\t: style.captionContainer;\n\n\t\tconst captionStyle = shouldShowCaptionExpanded\n\t\t\t? style.captionExpanded\n\t\t\t: getStylesFromColorScheme( style.caption, style.captionDark );\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<Image\n\t\t\t\t\tstyle={ imageStyle }\n\t\t\t\t\tsource={ { uri: url } }\n\t\t\t\t\t// alt={ alt }\n\t\t\t\t\taccessibilityLabel={ ariaLabel }\n\t\t\t\t\tref={ this.bindContainer }\n\t\t\t\t/>\n\t\t\t\t{ isUploadFailed && (\n\t\t\t\t\t<View style={ style.uploadFailedContainer }>\n\t\t\t\t\t\t<View style={ style.uploadFailed }>\n\t\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\t\ticon={ 'warning' }\n\t\t\t\t\t\t\t\t{ ...style.uploadFailedIcon }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t\t<Text style={ style.uploadFailedText }>\n\t\t\t\t\t\t\t{ retryMessage }\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\t\t\t\t<View style={ overlayStyle }>\n\t\t\t\t\t{ ! isUploadInProgress && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{ isSelected && (\n\t\t\t\t\t\t\t\t<View style={ style.toolbar }>\n\t\t\t\t\t\t\t\t\t<View style={ style.moverButtonContainer }>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tstyle={ buttonStyle }\n\t\t\t\t\t\t\t\t\t\t\ticon=\"arrow-left-alt\"\n\t\t\t\t\t\t\t\t\t\t\ticonSize={ ICON_SIZE_ARROW }\n\t\t\t\t\t\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\t\t\t\t\t\tisFirstItem\n\t\t\t\t\t\t\t\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\t: onMoveBackward\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\taccessibilityLabel={ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'Move Image Backward'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\taria-disabled={ isFirstItem }\n\t\t\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<View style={ separatorStyle }></View>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tstyle={ buttonStyle }\n\t\t\t\t\t\t\t\t\t\t\ticon=\"arrow-right-alt\"\n\t\t\t\t\t\t\t\t\t\t\ticonSize={ ICON_SIZE_ARROW }\n\t\t\t\t\t\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\t\t\t\t\t\tisLastItem\n\t\t\t\t\t\t\t\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\t: onMoveForward\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\taccessibilityLabel={ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'Move Image Forward'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\taria-disabled={ isLastItem }\n\t\t\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tstyle={ removeButtonStyle }\n\t\t\t\t\t\t\t\t\t\ticon=\"no-alt\"\n\t\t\t\t\t\t\t\t\t\ticonSize={ ICON_SIZE_REMOVE }\n\t\t\t\t\t\t\t\t\t\tonClick={ onRemove }\n\t\t\t\t\t\t\t\t\t\taccessibilityLabel={ __(\n\t\t\t\t\t\t\t\t\t\t\t'Remove Image'\n\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t{ ( shouldShowCaptionEditable ||\n\t\t\t\t\t\t\t\tshouldShowCaptionExpanded ) && (\n\t\t\t\t\t\t\t\t<View style={ captionContainerStyle }>\n\t\t\t\t\t\t\t\t\t<ScrollView\n\t\t\t\t\t\t\t\t\t\tnestedScrollEnabled\n\t\t\t\t\t\t\t\t\t\tkeyboardShouldPersistTaps=\"handled\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Caption\n\t\t\t\t\t\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t\t\t\t\t\tisSelected={ captionSelected }\n\t\t\t\t\t\t\t\t\t\t\tonChange={ this.onCaptionChange }\n\t\t\t\t\t\t\t\t\t\t\tonFocus={ this.onSelectCaption }\n\t\t\t\t\t\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\t\t\t\t\t\tisSelected\n\t\t\t\t\t\t\t\t\t\t\t\t\t? __( 'Write caption…' )\n\t\t\t\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tplaceholderTextColor={\n\t\t\t\t\t\t\t\t\t\t\t\tcaptionPlaceholderStyle.color\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tstyle={ captionStyle }\n\t\t\t\t\t\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</ScrollView>\n\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\t\t\t\t</View>\n\t\t\t</>\n\t\t);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tid,\n\t\t\tonRemove,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tisSelected,\n\t\t} = this.props;\n\n\t\tconst containerStyle = getStylesFromColorScheme(\n\t\t\tstyle.galleryImageContainer,\n\t\t\tstyle.galleryImageContainerDark\n\t\t);\n\n\t\treturn (\n\t\t\t<TouchableWithoutFeedback\n\t\t\t\tonPress={ this.onMediaPressed }\n\t\t\t\taccessible={ ! isSelected } // We need only child views to be accessible after the selection\n\t\t\t\taccessibilityLabel={ this.accessibilityLabelImageContainer() } // if we don't set this explicitly it reads system provided accessibilityLabels of all child components and those include pretty technical words which don't make sense\n\t\t\t\taccessibilityRole={ 'imagebutton' } // this makes VoiceOver to read a description of image provided by system on iOS and lets user know this is a button which conveys the message of tappablity\n\t\t\t>\n\t\t\t\t<View style={ containerStyle }>\n\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonMediaUploadStateReset={ onRemove }\n\t\t\t\t\t\trenderContent={ this.renderContent }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\t}\n\n\taccessibilityLabelImageContainer() {\n\t\tconst { caption, 'aria-label': ariaLabel } = this.props;\n\n\t\treturn isEmpty( caption )\n\t\t\t? ariaLabel\n\t\t\t: ariaLabel +\n\t\t\t\t\t'. ' +\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\t\tcaption\n\t\t\t\t\t);\n\t}\n}\n\nexport default withPreferredColorScheme( GalleryImage );\n"]}