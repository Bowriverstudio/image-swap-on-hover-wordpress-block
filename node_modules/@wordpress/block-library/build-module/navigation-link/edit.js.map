{"version":3,"sources":["@wordpress/block-library/src/navigation-link/edit.js"],"names":["classnames","escape","unescape","compose","createBlock","withDispatch","withSelect","ExternalLink","KeyboardShortcuts","PanelBody","Popover","TextareaControl","TextControl","ToggleControl","ToolbarButton","ToolbarGroup","rawShortcut","displayShortcut","__","BlockControls","InnerBlocks","InspectorControls","RichText","__experimentalLinkControl","LinkControl","isURL","prependHTTP","Fragment","useState","useEffect","useRef","placeCaretAtHorizontalEdge","toolbarSubmenuIcon","itemSubmenuIcon","NavigationLinkEdit","attributes","hasDescendants","isSelected","isParentOfSelectedBlock","setAttributes","showSubmenuIcon","insertLinkBlock","label","opensInNewTab","title","url","nofollow","description","link","isLinkOpen","setIsLinkOpen","itemLabelPlaceholder","ref","test","selectLabelText","current","focus","selection","window","getSelection","range","document","createRange","selectNodeContents","removeAllRanges","addRange","primary","titleValue","nofollowValue","descriptionValue","labelValue","newTitle","newURL","newOpensInNewTab","id","encodeURI","normalizedTitle","replace","normalizedURL","DefaultAppender","select","ownProps","getBlockName","getBlockAttributes","getBlockParents","getClientIdsOfDescendants","hasSelectedInnerBlock","clientId","rootBlock","parentBlock","rootBlockAttributes","length","isLevelZero","dispatch","registry","insertBlock","navItems","insertionPoint","blockToInsert"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { escape, unescape } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { compose } from '@wordpress/compose';\nimport { createBlock } from '@wordpress/blocks';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport {\n\tExternalLink,\n\tKeyboardShortcuts,\n\tPanelBody,\n\tPopover,\n\tTextareaControl,\n\tTextControl,\n\tToggleControl,\n\tToolbarButton,\n\tToolbarGroup,\n} from '@wordpress/components';\nimport { rawShortcut, displayShortcut } from '@wordpress/keycodes';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tBlockControls,\n\tInnerBlocks,\n\tInspectorControls,\n\tRichText,\n\t__experimentalLinkControl as LinkControl,\n} from '@wordpress/block-editor';\nimport { isURL, prependHTTP } from '@wordpress/url';\nimport { Fragment, useState, useEffect, useRef } from '@wordpress/element';\nimport { placeCaretAtHorizontalEdge } from '@wordpress/dom';\n/**\n * Internal dependencies\n */\nimport { toolbarSubmenuIcon, itemSubmenuIcon } from './icons';\n\nfunction NavigationLinkEdit( {\n\tattributes,\n\thasDescendants,\n\tisSelected,\n\tisParentOfSelectedBlock,\n\tsetAttributes,\n\tshowSubmenuIcon,\n\tinsertLinkBlock,\n} ) {\n\tconst {\n\t\tlabel,\n\t\topensInNewTab,\n\t\ttitle,\n\t\turl,\n\t\tnofollow,\n\t\tdescription,\n\t} = attributes;\n\tconst link = {\n\t\ttitle: title ? unescape( title ) : '',\n\t\turl,\n\t\topensInNewTab,\n\t};\n\tconst [ isLinkOpen, setIsLinkOpen ] = useState( false );\n\tconst itemLabelPlaceholder = __( 'Add linkâ€¦' );\n\tconst ref = useRef();\n\n\t// Show the LinkControl on mount if the URL is empty\n\t// ( When adding a new menu item)\n\t// This can't be done in the useState call because it cconflicts\n\t// with the autofocus behavior of the BlockListBlock component.\n\tuseEffect( () => {\n\t\tif ( ! url ) {\n\t\t\tsetIsLinkOpen( true );\n\t\t}\n\t}, [] );\n\n\t/**\n\t * The hook shouldn't be necessary but due to a focus loss happening\n\t * when selecting a suggestion in the link popover, we force close on block unselection.\n\t */\n\tuseEffect( () => {\n\t\tif ( ! isSelected ) {\n\t\t\tsetIsLinkOpen( false );\n\t\t}\n\t}, [ isSelected ] );\n\n\t// If the LinkControl popover is open and the URL has changed, close the LinkControl and focus the label text.\n\tuseEffect( () => {\n\t\tif ( isLinkOpen && url ) {\n\t\t\t// Close the link.\n\t\t\tsetIsLinkOpen( false );\n\n\t\t\t// Does this look like a URL and have something TLD-ish?\n\t\t\tif (\n\t\t\t\tisURL( prependHTTP( label ) ) &&\n\t\t\t\t/^.+\\.[a-z]+/.test( label )\n\t\t\t) {\n\t\t\t\t// Focus and select the label text.\n\t\t\t\tselectLabelText();\n\t\t\t} else {\n\t\t\t\t// Focus it (but do not select).\n\t\t\t\tplaceCaretAtHorizontalEdge( ref.current, true );\n\t\t\t}\n\t\t}\n\t}, [ url ] );\n\n\t/**\n\t * Focus the navigation link label text and select it.\n\t */\n\tfunction selectLabelText() {\n\t\tref.current.focus();\n\t\tconst selection = window.getSelection();\n\t\tconst range = document.createRange();\n\t\t// Get the range of the current ref contents so we can add this range to the selection.\n\t\trange.selectNodeContents( ref.current );\n\t\tselection.removeAllRanges();\n\t\tselection.addRange( range );\n\t}\n\n\treturn (\n\t\t<Fragment>\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<KeyboardShortcuts\n\t\t\t\t\t\tbindGlobal\n\t\t\t\t\t\tshortcuts={ {\n\t\t\t\t\t\t\t[ rawShortcut.primary( 'k' ) ]: () =>\n\t\t\t\t\t\t\t\tsetIsLinkOpen( true ),\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\tname=\"link\"\n\t\t\t\t\t\ticon=\"admin-links\"\n\t\t\t\t\t\ttitle={ __( 'Link' ) }\n\t\t\t\t\t\tshortcut={ displayShortcut.primary( 'k' ) }\n\t\t\t\t\t\tonClick={ () => setIsLinkOpen( true ) }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\tname=\"submenu\"\n\t\t\t\t\t\ticon={ toolbarSubmenuIcon }\n\t\t\t\t\t\ttitle={ __( 'Add submenu' ) }\n\t\t\t\t\t\tonClick={ insertLinkBlock }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t</BlockControls>\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'SEO settings' ) }>\n\t\t\t\t\t<TextControl\n\t\t\t\t\t\tvalue={ title || '' }\n\t\t\t\t\t\tonChange={ ( titleValue ) => {\n\t\t\t\t\t\t\tsetAttributes( { title: titleValue } );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tlabel={ __( 'Title Attribute' ) }\n\t\t\t\t\t\thelp={ __(\n\t\t\t\t\t\t\t'Provide more context about where the link goes.'\n\t\t\t\t\t\t) }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tchecked={ nofollow }\n\t\t\t\t\t\tonChange={ ( nofollowValue ) => {\n\t\t\t\t\t\t\tsetAttributes( { nofollow: nofollowValue } );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tlabel={ __( 'Add nofollow to link' ) }\n\t\t\t\t\t\thelp={\n\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t\t\t\"Don't let search engines follow this link.\"\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\t\t\tclassName=\"wp-block-navigation-link__nofollow-external-link\"\n\t\t\t\t\t\t\t\t\thref={ __(\n\t\t\t\t\t\t\t\t\t\t'https://codex.wordpress.org/Nofollow'\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ __( \"What's this?\" ) }\n\t\t\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody title={ __( 'Link settings' ) }>\n\t\t\t\t\t<TextareaControl\n\t\t\t\t\t\tvalue={ description || '' }\n\t\t\t\t\t\tonChange={ ( descriptionValue ) => {\n\t\t\t\t\t\t\tsetAttributes( { description: descriptionValue } );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tlabel={ __( 'Description' ) }\n\t\t\t\t\t\thelp={ __(\n\t\t\t\t\t\t\t'The description will be displayed in the menu if the current theme supports it.'\n\t\t\t\t\t\t) }\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t<div\n\t\t\t\tclassName={ classnames( 'wp-block-navigation-link', {\n\t\t\t\t\t'is-editing': isSelected || isParentOfSelectedBlock,\n\t\t\t\t\t'is-selected': isSelected,\n\t\t\t\t\t'has-link': !! url,\n\t\t\t\t} ) }\n\t\t\t>\n\t\t\t\t<div className=\"wp-block-navigation-link__content\">\n\t\t\t\t\t<RichText\n\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\ttagName=\"span\"\n\t\t\t\t\t\tclassName=\"wp-block-navigation-link__label\"\n\t\t\t\t\t\tvalue={ label }\n\t\t\t\t\t\tonChange={ ( labelValue ) =>\n\t\t\t\t\t\t\tsetAttributes( { label: labelValue } )\n\t\t\t\t\t\t}\n\t\t\t\t\t\tplaceholder={ itemLabelPlaceholder }\n\t\t\t\t\t\twithoutInteractiveFormatting\n\t\t\t\t\t\tallowedFormats={ [\n\t\t\t\t\t\t\t'core/bold',\n\t\t\t\t\t\t\t'core/italic',\n\t\t\t\t\t\t\t'core/image',\n\t\t\t\t\t\t\t'core/strikethrough',\n\t\t\t\t\t\t] }\n\t\t\t\t\t/>\n\t\t\t\t\t{ showSubmenuIcon && (\n\t\t\t\t\t\t<span className=\"wp-block-navigation-link__submenu-icon\">\n\t\t\t\t\t\t\t{ itemSubmenuIcon }\n\t\t\t\t\t\t</span>\n\t\t\t\t\t) }\n\t\t\t\t\t{ isLinkOpen && (\n\t\t\t\t\t\t<Popover\n\t\t\t\t\t\t\tposition=\"bottom center\"\n\t\t\t\t\t\t\tonClose={ () => setIsLinkOpen( false ) }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<LinkControl\n\t\t\t\t\t\t\t\tclassName=\"wp-block-navigation-link__inline-link-input\"\n\t\t\t\t\t\t\t\tvalue={ link }\n\t\t\t\t\t\t\t\tshowInitialSuggestions={ true }\n\t\t\t\t\t\t\t\tonChange={ ( {\n\t\t\t\t\t\t\t\t\ttitle: newTitle = '',\n\t\t\t\t\t\t\t\t\turl: newURL = '',\n\t\t\t\t\t\t\t\t\topensInNewTab: newOpensInNewTab,\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t} = {} ) =>\n\t\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\t\ttitle: escape( newTitle ),\n\t\t\t\t\t\t\t\t\t\turl: encodeURI( newURL ),\n\t\t\t\t\t\t\t\t\t\tlabel: ( () => {\n\t\t\t\t\t\t\t\t\t\t\tconst normalizedTitle = newTitle.replace(\n\t\t\t\t\t\t\t\t\t\t\t\t/http(s?):\\/\\//gi,\n\t\t\t\t\t\t\t\t\t\t\t\t''\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\tconst normalizedURL = newURL.replace(\n\t\t\t\t\t\t\t\t\t\t\t\t/http(s?):\\/\\//gi,\n\t\t\t\t\t\t\t\t\t\t\t\t''\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\t\tnewTitle !== '' &&\n\t\t\t\t\t\t\t\t\t\t\t\tnormalizedTitle !==\n\t\t\t\t\t\t\t\t\t\t\t\t\tnormalizedURL &&\n\t\t\t\t\t\t\t\t\t\t\t\tlabel !== newTitle\n\t\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn escape( newTitle );\n\t\t\t\t\t\t\t\t\t\t\t} else if ( label ) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn label;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t// If there's no label, add the URL.\n\t\t\t\t\t\t\t\t\t\t\treturn escape( normalizedURL );\n\t\t\t\t\t\t\t\t\t\t} )(),\n\t\t\t\t\t\t\t\t\t\topensInNewTab: newOpensInNewTab,\n\t\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Popover>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t\t<InnerBlocks\n\t\t\t\t\tallowedBlocks={ [ 'core/navigation-link' ] }\n\t\t\t\t\trenderAppender={\n\t\t\t\t\t\t( hasDescendants && isSelected ) ||\n\t\t\t\t\t\tisParentOfSelectedBlock\n\t\t\t\t\t\t\t? InnerBlocks.DefaultAppender\n\t\t\t\t\t\t\t: false\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</Fragment>\n\t);\n}\n\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\tgetBlockName,\n\t\t\tgetBlockAttributes,\n\t\t\tgetBlockParents,\n\t\t\tgetClientIdsOfDescendants,\n\t\t\thasSelectedInnerBlock,\n\t\t} = select( 'core/block-editor' );\n\t\tconst { clientId } = ownProps;\n\t\tconst rootBlock = getBlockParents( clientId )[ 0 ];\n\t\tconst parentBlock = getBlockParents( clientId, true )[ 0 ];\n\t\tconst rootBlockAttributes = getBlockAttributes( rootBlock );\n\t\tconst hasDescendants = !! getClientIdsOfDescendants( [ clientId ] )\n\t\t\t.length;\n\t\tconst isLevelZero = getBlockName( parentBlock ) === 'core/navigation';\n\t\tconst showSubmenuIcon =\n\t\t\trootBlockAttributes.showSubmenuIcon &&\n\t\t\tisLevelZero &&\n\t\t\thasDescendants;\n\t\tconst isParentOfSelectedBlock = hasSelectedInnerBlock( clientId, true );\n\n\t\treturn {\n\t\t\tisParentOfSelectedBlock,\n\t\t\thasDescendants,\n\t\t\tshowSubmenuIcon,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps, registry ) => {\n\t\treturn {\n\t\t\tinsertLinkBlock() {\n\t\t\t\tconst { clientId } = ownProps;\n\n\t\t\t\tconst { insertBlock } = dispatch( 'core/block-editor' );\n\n\t\t\t\tconst { getClientIdsOfDescendants } = registry.select(\n\t\t\t\t\t'core/block-editor'\n\t\t\t\t);\n\t\t\t\tconst navItems = getClientIdsOfDescendants( [ clientId ] );\n\t\t\t\tconst insertionPoint = navItems.length ? navItems.length : 0;\n\n\t\t\t\tconst blockToInsert = createBlock( 'core/navigation-link' );\n\n\t\t\t\tinsertBlock( blockToInsert, insertionPoint, clientId );\n\t\t\t},\n\t\t};\n\t} ),\n] )( NavigationLinkEdit );\n"]}