{"version":3,"sources":["@wordpress/block-library/src/image/edit.native.js"],"names":["React","View","ImageBackground","Text","TouchableWithoutFeedback","Dimensions","requestMediaImport","mediaUploadSync","requestImageFailedRetryDialog","requestImageUploadCancelDialog","requestImageFullscreenPreview","showMediaEditorButton","isEmpty","map","get","Icon","PanelBody","PanelActions","SelectControl","TextControl","ToggleControl","ToolbarButton","ToolbarGroup","BlockCaption","MediaPlaceholder","MediaUpload","MediaUploadProgress","MEDIA_TYPE_IMAGE","BlockControls","InspectorControls","BlockAlignmentToolbar","MediaEdit","__","sprintf","isURL","doAction","hasAction","compose","withPreferredColorScheme","withSelect","image","icon","styles","editImageIcon","SvgIconRetry","SvgIconCustomize","getUpdatedLinkTargetSettings","LINK_DESTINATION_CUSTOM","LINK_DESTINATION_NONE","ICON_TYPE","PLACEHOLDER","RETRY","UPLOAD","IMAGE_SIZE_THUMBNAIL","IMAGE_SIZE_MEDIUM","IMAGE_SIZE_LARGE","IMAGE_SIZE_FULL_SIZE","DEFAULT_SIZE_SLUG","sizeOptionLabels","sizeOptions","label","option","value","IMAGE_ASPECT_RATIO","getUrlForSlug","sizeSlug","ImageEdit","props","state","isCaptionSelected","finishMediaUploadWithSuccess","bind","finishMediaUploadWithFailure","mediaUploadStateReset","onSelectMediaUploadOption","updateMediaProgress","updateAlt","updateImageURL","onSetLinkDestination","onSetNewTab","onSetSizeSlug","onImagePressed","onClearSettings","onFocusCaption","updateAlignment","attributes","setAttributes","id","url","console","warn","indexOf","isUploadInProgress","previousProps","source_url","setState","payload","mediaUrl","mediaServerId","mediaId","newAlt","alt","width","undefined","height","nextAlign","align","href","linkDestination","updatedLinkTarget","linkTarget","rel","media","mediaAttributes","additionalAttributes","onFocus","iconType","iconStyle","iconRetry","getStylesFromColorScheme","iconPlaceholder","iconPlaceholderDark","iconUpload","iconUploadDark","isSelected","actions","onPress","getToolbarEditButton","open","getInspectorControls","__DEV__","newValue","flex","getIcon","alignToFlex","left","center","right","full","wide","imageContainerHeight","editImageComponent","mediaOptions","editContainer","edit","iconCustomise","getImageComponent","openMediaOptions","getMediaOptions","isUploadFailed","finalWidth","finalHeight","imageWidthWithinContainer","retryMessage","opacity","imageBorderOnSelectedStyle","imageBorder","iconRetryContainer","modalIcon","alignSelf","imageContainerUpload","imageContainerUploadDark","imageUploadingIconContainer","uri","imageContainer","backgroundColor","uploadFailedText","clientId","caption","onBlur","Component","select","getMedia"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\nimport {\n\tView,\n\tImageBackground,\n\tText,\n\tTouchableWithoutFeedback,\n\tDimensions,\n} from 'react-native';\nimport {\n\trequestMediaImport,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n\tshowMediaEditorButton,\n} from 'react-native-gutenberg-bridge';\nimport { isEmpty, map, get } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tIcon,\n\tPanelBody,\n\tPanelActions,\n\tSelectControl,\n\tTextControl,\n\tToggleControl,\n\tToolbarButton,\n\tToolbarGroup,\n} from '@wordpress/components';\nimport {\n\tBlockCaption,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n\tMEDIA_TYPE_IMAGE,\n\tBlockControls,\n\tInspectorControls,\n\tBlockAlignmentToolbar,\n\tMediaEdit,\n} from '@wordpress/block-editor';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { isURL } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport { image as icon } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport { editImageIcon } from './icon';\nimport SvgIconRetry from './icon-retry';\nimport SvgIconCustomize from './icon-customize';\nimport { getUpdatedLinkTargetSettings } from './utils';\n\nimport { LINK_DESTINATION_CUSTOM, LINK_DESTINATION_NONE } from './constants';\n\nconst ICON_TYPE = {\n\tPLACEHOLDER: 'placeholder',\n\tRETRY: 'retry',\n\tUPLOAD: 'upload',\n};\nconst IMAGE_SIZE_THUMBNAIL = 'thumbnail';\nconst IMAGE_SIZE_MEDIUM = 'medium';\nconst IMAGE_SIZE_LARGE = 'large';\nconst IMAGE_SIZE_FULL_SIZE = 'full';\nconst DEFAULT_SIZE_SLUG = IMAGE_SIZE_LARGE;\nconst sizeOptionLabels = {\n\t[ IMAGE_SIZE_THUMBNAIL ]: __( 'Thumbnail' ),\n\t[ IMAGE_SIZE_MEDIUM ]: __( 'Medium' ),\n\t[ IMAGE_SIZE_LARGE ]: __( 'Large' ),\n\t[ IMAGE_SIZE_FULL_SIZE ]: __( 'Full Size' ),\n};\nconst sizeOptions = map( sizeOptionLabels, ( label, option ) => ( {\n\tvalue: option,\n\tlabel,\n} ) );\n\n// Default Image ratio 4:3\nconst IMAGE_ASPECT_RATIO = 4 / 3;\n\nconst getUrlForSlug = ( image, { sizeSlug } ) => {\n\treturn get( image, [ 'media_details', 'sizes', sizeSlug, 'source_url' ] );\n};\n\nexport class ImageEdit extends React.Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tisCaptionSelected: false,\n\t\t};\n\n\t\tthis.finishMediaUploadWithSuccess = this.finishMediaUploadWithSuccess.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.finishMediaUploadWithFailure = this.finishMediaUploadWithFailure.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.mediaUploadStateReset = this.mediaUploadStateReset.bind( this );\n\t\tthis.onSelectMediaUploadOption = this.onSelectMediaUploadOption.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateAlt = this.updateAlt.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetLinkDestination = this.onSetLinkDestination.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.onSetSizeSlug = this.onSetSizeSlug.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onClearSettings = this.onClearSettings.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.updateAlignment = this.updateAlignment.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes } = this.props;\n\n\t\t// This will warn when we have `id` defined, while `url` is undefined.\n\t\t// This may help track this issue: https://github.com/wordpress-mobile/WordPress-Android/issues/9768\n\t\t// where a cancelled image upload was resulting in a subsequent crash.\n\t\tif ( attributes.id && ! attributes.url ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn( 'Attributes has id with no url.' );\n\t\t}\n\n\t\t// Detect any pasted image and start an upload\n\t\tif (\n\t\t\t! attributes.id &&\n\t\t\tattributes.url &&\n\t\t\tattributes.url.indexOf( 'file:' ) === 0\n\t\t) {\n\t\t\trequestMediaImport( attributes.url, ( id, url ) => {\n\t\t\t\tif ( url ) {\n\t\t\t\t\tsetAttributes( { id, url } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure we mark any temporary images as failed if they failed while\n\t\t// the editor wasn't open\n\t\tif ( attributes.id && attributes.url && ! isURL( attributes.url ) ) {\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// this action will only exist if the user pressed the trash button on the block holder\n\t\tif (\n\t\t\thasAction( 'blocks.onRemoveBlockCheckUpload' ) &&\n\t\t\tthis.state.isUploadInProgress\n\t\t) {\n\t\t\tdoAction(\n\t\t\t\t'blocks.onRemoveBlockCheckUpload',\n\t\t\t\tthis.props.attributes.id\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( previousProps ) {\n\t\tif ( ! previousProps.image && this.props.image ) {\n\t\t\tconst { image, attributes } = this.props;\n\t\t\tconst url = getUrlForSlug( image, attributes ) || image.source_url;\n\t\t\tthis.props.setAttributes( { url } );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\t// Avoid a UI flicker in the toolbar by insuring that isCaptionSelected\n\t\t// is updated immediately any time the isSelected prop becomes false\n\t\treturn {\n\t\t\tisCaptionSelected: props.isSelected && state.isCaptionSelected,\n\t\t};\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes, image } = this.props;\n\n\t\tif ( this.state.isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if ( attributes.id && ! isURL( attributes.url ) ) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t} else if ( ! this.state.isCaptionSelected ) {\n\t\t\trequestImageFullscreenPreview(\n\t\t\t\tattributes.url,\n\t\t\t\timage && image.source_url\n\t\t\t);\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisCaptionSelected: false,\n\t\t} );\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\n\t\tif ( ! this.state.isUploadInProgress ) {\n\t\t\tthis.setState( { isUploadInProgress: true } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tmediaUploadStateReset() {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: null, url: null } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tupdateAlt( newAlt ) {\n\t\tthis.props.setAttributes( { alt: newAlt } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t} );\n\t}\n\n\tupdateAlignment( nextAlign ) {\n\t\tthis.props.setAttributes( { align: nextAlign } );\n\t}\n\n\tonSetLinkDestination( href ) {\n\t\tthis.props.setAttributes( {\n\t\t\tlinkDestination: LINK_DESTINATION_CUSTOM,\n\t\t\thref,\n\t\t} );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst updatedLinkTarget = getUpdatedLinkTargetSettings(\n\t\t\tvalue,\n\t\t\tthis.props.attributes\n\t\t);\n\t\tthis.props.setAttributes( updatedLinkTarget );\n\t}\n\n\tonSetSizeSlug( sizeSlug ) {\n\t\tconst { image } = this.props;\n\n\t\tconst url = getUrlForSlug( image, { sizeSlug } );\n\t\tif ( ! url ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsizeSlug,\n\t\t} );\n\t}\n\n\tonClearSettings() {\n\t\tthis.props.setAttributes( {\n\t\t\talt: '',\n\t\t\tlinkDestination: LINK_DESTINATION_NONE,\n\t\t\thref: undefined,\n\t\t\tlinkTarget: undefined,\n\t\t\tsizeSlug: DEFAULT_SIZE_SLUG,\n\t\t\trel: undefined,\n\t\t} );\n\t}\n\n\tonSelectMediaUploadOption( media ) {\n\t\tconst { id, url } = this.props.attributes;\n\n\t\tconst mediaAttributes = {\n\t\t\tid: media.id,\n\t\t\turl: media.url,\n\t\t};\n\n\t\tlet additionalAttributes;\n\t\t// Reset the dimension attributes if changing to a different image.\n\t\tif ( ! media.id || media.id !== id ) {\n\t\t\tadditionalAttributes = {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\tsizeSlug: DEFAULT_SIZE_SLUG,\n\t\t\t};\n\t\t} else {\n\t\t\t// Keep the same url when selecting the same file, so \"Image Size\" option is not changed.\n\t\t\tadditionalAttributes = { url };\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\t...mediaAttributes,\n\t\t\t...additionalAttributes,\n\t\t} );\n\t}\n\n\tonFocusCaption() {\n\t\tif ( this.props.onFocus ) {\n\t\t\tthis.props.onFocus();\n\t\t}\n\t\tif ( ! this.state.isCaptionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tisCaptionSelected: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetIcon( iconType ) {\n\t\tlet iconStyle;\n\t\tswitch ( iconType ) {\n\t\t\tcase ICON_TYPE.RETRY:\n\t\t\t\treturn <Icon icon={ SvgIconRetry } { ...styles.iconRetry } />;\n\t\t\tcase ICON_TYPE.PLACEHOLDER:\n\t\t\t\ticonStyle = this.props.getStylesFromColorScheme(\n\t\t\t\t\tstyles.iconPlaceholder,\n\t\t\t\t\tstyles.iconPlaceholderDark\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase ICON_TYPE.UPLOAD:\n\t\t\t\ticonStyle = this.props.getStylesFromColorScheme(\n\t\t\t\t\tstyles.iconUpload,\n\t\t\t\t\tstyles.iconUploadDark\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t}\n\t\treturn <Icon icon={ icon } { ...iconStyle } />;\n\t}\n\n\trender() {\n\t\tconst { attributes, isSelected, image } = this.props;\n\t\tconst {\n\t\t\talign,\n\t\t\turl,\n\t\t\theight,\n\t\t\twidth,\n\t\t\talt,\n\t\t\thref,\n\t\t\tid,\n\t\t\tlinkTarget,\n\t\t\tsizeSlug,\n\t\t} = attributes;\n\n\t\tconst actions = [\n\t\t\t{\n\t\t\t\tlabel: __( 'Clear All Settings' ),\n\t\t\t\tonPress: this.onClearSettings,\n\t\t\t},\n\t\t];\n\n\t\tconst getToolbarEditButton = ( open ) => (\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\t\t\t\ticon={ editImageIcon }\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\tvalue={ align }\n\t\t\t\t\tonChange={ this.updateAlignment }\n\t\t\t\t\tisCollapsed={ false }\n\t\t\t\t/>\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Image settings' ) }>\n\t\t\t\t\t<TextControl\n\t\t\t\t\t\ticon={ 'admin-links' }\n\t\t\t\t\t\tlabel={ __( 'Link To' ) }\n\t\t\t\t\t\tvalue={ href || '' }\n\t\t\t\t\t\tvaluePlaceholder={ __( 'Add URL' ) }\n\t\t\t\t\t\tonChange={ this.onSetLinkDestination }\n\t\t\t\t\t\tautoCapitalize=\"none\"\n\t\t\t\t\t\tautoCorrect={ false }\n\t\t\t\t\t\tkeyboardType=\"url\"\n\t\t\t\t\t/>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\ticon={ 'external' }\n\t\t\t\t\t\tlabel={ __( 'Open in new tab' ) }\n\t\t\t\t\t\tchecked={ linkTarget === '_blank' }\n\t\t\t\t\t\tonChange={ this.onSetNewTab }\n\t\t\t\t\t/>\n\t\t\t\t\t{ // eslint-disable-next-line no-undef\n\t\t\t\t\timage && __DEV__ && (\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\thideCancelButton\n\t\t\t\t\t\t\ticon={ 'editor-expand' }\n\t\t\t\t\t\t\tlabel={ __( 'Size' ) }\n\t\t\t\t\t\t\tvalue={\n\t\t\t\t\t\t\t\tsizeOptionLabels[\n\t\t\t\t\t\t\t\t\tsizeSlug || DEFAULT_SIZE_SLUG\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonChangeValue={ ( newValue ) =>\n\t\t\t\t\t\t\t\tthis.onSetSizeSlug( newValue )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\toptions={ sizeOptions }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t<TextControl\n\t\t\t\t\t\ticon={ 'editor-textcolor' }\n\t\t\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\t\t\tvalue={ alt || '' }\n\t\t\t\t\t\tvaluePlaceholder={ __( 'None' ) }\n\t\t\t\t\t\tseparatorType={ 'none' }\n\t\t\t\t\t\tonChangeValue={ this.updateAlt }\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelActions actions={ actions } />\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ { flex: 1 } }>\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\t\t\ticon={ this.getIcon( ICON_TYPE.PLACEHOLDER ) }\n\t\t\t\t\t\tonFocus={ this.props.onFocus }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst alignToFlex = {\n\t\t\tleft: 'flex-start',\n\t\t\tcenter: 'center',\n\t\t\tright: 'flex-end',\n\t\t\tfull: 'center',\n\t\t\twide: 'center',\n\t\t};\n\n\t\tconst imageContainerHeight =\n\t\t\tDimensions.get( 'window' ).width / IMAGE_ASPECT_RATIO;\n\n\t\tconst editImageComponent = ( { open, mediaOptions } ) => (\n\t\t\t<TouchableWithoutFeedback onPress={ open }>\n\t\t\t\t<View style={ styles.editContainer }>\n\t\t\t\t\t<View style={ styles.edit }>\n\t\t\t\t\t\t{ mediaOptions() }\n\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\tsize={ 16 }\n\t\t\t\t\t\t\ticon={ SvgIconCustomize }\n\t\t\t\t\t\t\t{ ...styles.iconCustomise }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\n\t\tconst getImageComponent = ( openMediaOptions, getMediaOptions ) => (\n\t\t\t<TouchableWithoutFeedback\n\t\t\t\taccessible={ ! isSelected }\n\t\t\t\tonPress={ this.onImagePressed }\n\t\t\t\tonLongPress={ openMediaOptions }\n\t\t\t\tdisabled={ ! isSelected }\n\t\t\t>\n\t\t\t\t<View style={ { flex: 1 } }>\n\t\t\t\t\t{ getInspectorControls() }\n\t\t\t\t\t{ getMediaOptions() }\n\t\t\t\t\t{ ! this.state.isCaptionSelected &&\n\t\t\t\t\t\tgetToolbarEditButton( openMediaOptions ) }\n\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\theight={ height }\n\t\t\t\t\t\twidth={ width }\n\t\t\t\t\t\tcoverUrl={ url }\n\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonMediaUploadStateReset={ this.mediaUploadStateReset }\n\t\t\t\t\t\trenderContent={ ( {\n\t\t\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\t\t\tisUploadFailed,\n\t\t\t\t\t\t\tfinalWidth,\n\t\t\t\t\t\t\tfinalHeight,\n\t\t\t\t\t\t\timageWidthWithinContainer,\n\t\t\t\t\t\t\tretryMessage,\n\t\t\t\t\t\t} ) => {\n\t\t\t\t\t\t\tconst opacity = isUploadInProgress ? 0.3 : 1;\n\t\t\t\t\t\t\tconst imageBorderOnSelectedStyle =\n\t\t\t\t\t\t\t\tisSelected &&\n\t\t\t\t\t\t\t\t! (\n\t\t\t\t\t\t\t\t\tisUploadInProgress ||\n\t\t\t\t\t\t\t\t\tisUploadFailed ||\n\t\t\t\t\t\t\t\t\tthis.state.isCaptionSelected\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t? styles.imageBorder\n\t\t\t\t\t\t\t\t\t: '';\n\n\t\t\t\t\t\t\tconst iconRetryContainer = (\n\t\t\t\t\t\t\t\t<View style={ styles.modalIcon }>\n\t\t\t\t\t\t\t\t\t{ this.getIcon( ICON_TYPE.RETRY ) }\n\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<View\n\t\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\t\tflex: 1,\n\t\t\t\t\t\t\t\t\t\t// only set alignSelf if an image exists because alignSelf causes the placeholder\n\t\t\t\t\t\t\t\t\t\t// to disappear when an aligned image can't be downloaded\n\t\t\t\t\t\t\t\t\t\t// https://github.com/wordpress-mobile/gutenberg-mobile/issues/1592\n\t\t\t\t\t\t\t\t\t\talignSelf:\n\t\t\t\t\t\t\t\t\t\t\timageWidthWithinContainer &&\n\t\t\t\t\t\t\t\t\t\t\talignToFlex[ align ],\n\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ ! imageWidthWithinContainer && (\n\t\t\t\t\t\t\t\t\t\t<View\n\t\t\t\t\t\t\t\t\t\t\tstyle={ [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.props.getStylesFromColorScheme(\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyles.imageContainerUpload,\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyles.imageContainerUploadDark\n\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\theight: imageContainerHeight,\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t] }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<View\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyles.imageUploadingIconContainer\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{ this.getIcon(\n\t\t\t\t\t\t\t\t\t\t\t\t\tICON_TYPE.UPLOAD\n\t\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t<ImageBackground\n\t\t\t\t\t\t\t\t\t\taccessible={ true }\n\t\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t\t\taccessibilityLabel={ alt }\n\t\t\t\t\t\t\t\t\t\taccessibilityHint={ __(\n\t\t\t\t\t\t\t\t\t\t\t'Double tap and hold to edit'\n\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\taccessibilityRole={ 'imagebutton' }\n\t\t\t\t\t\t\t\t\t\tstyle={ [\n\t\t\t\t\t\t\t\t\t\t\timageBorderOnSelectedStyle,\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\twidth: finalWidth,\n\t\t\t\t\t\t\t\t\t\t\t\theight: finalHeight,\n\t\t\t\t\t\t\t\t\t\t\t\topacity,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t] }\n\t\t\t\t\t\t\t\t\t\tresizeMethod=\"scale\"\n\t\t\t\t\t\t\t\t\t\tsource={ { uri: url } }\n\t\t\t\t\t\t\t\t\t\tkey={ url }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ isUploadFailed && (\n\t\t\t\t\t\t\t\t\t\t\t<View\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={ [\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyles.imageContainer,\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tflex: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbackgroundColor:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'rgba(0, 0, 0, 0.5)',\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t] }\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{ iconRetryContainer }\n\t\t\t\t\t\t\t\t\t\t\t\t<Text\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyles.uploadFailedText\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ retryMessage }\n\t\t\t\t\t\t\t\t\t\t\t\t</Text>\n\t\t\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t{ isSelected &&\n\t\t\t\t\t\t\t\t\t\t\t! isUploadInProgress &&\n\t\t\t\t\t\t\t\t\t\t\t! isUploadFailed &&\n\t\t\t\t\t\t\t\t\t\t\tfinalWidth &&\n\t\t\t\t\t\t\t\t\t\t\tfinalHeight &&\n\t\t\t\t\t\t\t\t\t\t\tshowMediaEditorButton && (\n\t\t\t\t\t\t\t\t\t\t\t\t<MediaEdit\n\t\t\t\t\t\t\t\t\t\t\t\t\tallowedTypes={ [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tMEDIA_TYPE_IMAGE,\n\t\t\t\t\t\t\t\t\t\t\t\t\t] }\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.onSelectMediaUploadOption\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tsource={ { uri: url } }\n\t\t\t\t\t\t\t\t\t\t\t\t\topenReplaceMediaOptions={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\topenMediaOptions\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\trender={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\teditImageComponent\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t</ImageBackground>\n\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t\t<BlockCaption\n\t\t\t\t\t\tclientId={ this.props.clientId }\n\t\t\t\t\t\tisSelected={ this.state.isCaptionSelected }\n\t\t\t\t\t\taccessible={ true }\n\t\t\t\t\t\taccessibilityLabelCreator={ ( caption ) =>\n\t\t\t\t\t\t\tisEmpty( caption )\n\t\t\t\t\t\t\t\t? /* translators: accessibility text. Empty image caption. */\n\t\t\t\t\t\t\t\t  'Image caption. Empty'\n\t\t\t\t\t\t\t\t: sprintf(\n\t\t\t\t\t\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\t\t\t\t\t\tcaption\n\t\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonFocus={ this.onFocusCaption }\n\t\t\t\t\t\tonBlur={ this.props.onBlur } // always assign onBlur as props\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\n\t\treturn (\n\t\t\t<MediaUpload\n\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\treturn getImageComponent( open, getMediaOptions );\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( 'core' );\n\t\tconst {\n\t\t\tattributes: { id },\n\t\t\tisSelected,\n\t\t} = props;\n\n\t\treturn {\n\t\t\timage: id && isSelected ? getMedia( id ) : null,\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( ImageEdit );\n"]}