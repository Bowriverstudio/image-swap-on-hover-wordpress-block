{"version":3,"sources":["@wordpress/components/src/custom-gradient-picker/control-points.js"],"names":["ControlPointKeyboardMove","arguments","increase","bind","decrease","shortcuts","right","left","event","stopPropagation","props","gradientIndex","onChange","gradientAST","children","Component","ControlPointButton","instanceId","isOpen","position","color","additionalProps","descriptionId","ControlPoints","gradientPickerDomRef","ignoreMarkerPosition","markerPoints","onStartControlPointChange","onStopControlPointChange","controlPointMoveState","onMouseMove","relativePosition","clientX","current","GRADIENT_MARKERS_WIDTH","referenceGradientAST","significantMoveHappened","initialPosition","colorStops","length","value","Math","abs","MINIMUM_SIGNIFICANT_MOVE","cleanEventListeners","window","removeEventListener","listenersActivated","map","point","index","positionValue","onToggle","addEventListener","onClose","rgb","COLOR_POPOVER_PROPS"],"mappings":"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","sourcesContent":["\n/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Component, useEffect, useRef } from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { withInstanceId } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport Button from '../button';\nimport ColorPicker from '../color-picker';\nimport Dropdown from '../dropdown';\nimport {\n\tgetGradientWithColorAtIndexChanged,\n\tgetGradientWithControlPointRemoved,\n\tgetGradientWithPositionAtIndexChanged,\n\tgetGradientWithPositionAtIndexDecreased,\n\tgetGradientWithPositionAtIndexIncreased,\n\tgetHorizontalRelativeGradientPosition,\n\tisControlPointOverlapping,\n} from './utils';\nimport {\n\tCOLOR_POPOVER_PROPS,\n\tGRADIENT_MARKERS_WIDTH,\n\tMINIMUM_SIGNIFICANT_MOVE,\n} from './constants';\nimport KeyboardShortcuts from '../keyboard-shortcuts';\n\nclass ControlPointKeyboardMove extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.increase = this.increase.bind( this );\n\t\tthis.decrease = this.decrease.bind( this );\n\t\tthis.shortcuts = {\n\t\t\tright: this.increase,\n\t\t\tleft: this.decrease,\n\t\t};\n\t}\n\tincrease( event ) {\n\t\t// Stop propagation of the key press event to avoid focus moving\n\t\t// to another editor area.\n\t\tevent.stopPropagation();\n\t\tconst { gradientIndex, onChange, gradientAST } = this.props;\n\t\tonChange( getGradientWithPositionAtIndexIncreased( gradientAST, gradientIndex ) );\n\t}\n\n\tdecrease( event ) {\n\t\t// Stop propagation of the key press event to avoid focus moving\n\t\t// to another editor area.\n\t\tevent.stopPropagation();\n\t\tconst { gradientIndex, onChange, gradientAST } = this.props;\n\t\tonChange( getGradientWithPositionAtIndexDecreased( gradientAST, gradientIndex ) );\n\t}\n\trender() {\n\t\tconst { children } = this.props;\n\t\treturn (\n\t\t\t<KeyboardShortcuts shortcuts={ this.shortcuts }>\n\t\t\t\t{ children }\n\t\t\t</KeyboardShortcuts>\n\t\t);\n\t}\n}\n\nconst ControlPointButton = withInstanceId(\n\tfunction( {\n\t\tinstanceId,\n\t\tisOpen,\n\t\tposition,\n\t\tcolor,\n\t\tonChange,\n\t\tgradientIndex,\n\t\tgradientAST,\n\t\t...additionalProps\n\t} ) {\n\t\tconst descriptionId = `components-custom-gradient-picker__control-point-button-description-${ instanceId }`;\n\t\treturn (\n\t\t\t<ControlPointKeyboardMove\n\t\t\t\tonChange={ onChange }\n\t\t\t\tgradientIndex={ gradientIndex }\n\t\t\t\tgradientAST={ gradientAST }\n\t\t\t>\n\t\t\t\t<Button\n\t\t\t\t\taria-label={\n\t\t\t\t\t\tsprintf(\n\t\t\t\t\t\t\t// translators: %1$s: gradient position e.g: 70%, %2$s: gradient color code e.g: rgb(52,121,151).\n\t\t\t\t\t\t\t__( 'Gradient control point at position %1$s with color code %2$s.' ),\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tcolor\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\taria-describedby={ descriptionId }\n\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\tclassName={\n\t\t\t\t\t\tclassnames(\n\t\t\t\t\t\t\t'components-custom-gradient-picker__control-point-button',\n\t\t\t\t\t\t\t{ 'is-active': isOpen }\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tleft: position,\n\t\t\t\t\t} }\n\t\t\t\t\t{ ...additionalProps }\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"screen-reader-text\"\n\t\t\t\t\tid={ descriptionId }>\n\t\t\t\t\t{ __(\n\t\t\t\t\t\t'Use your left or right arrow keys or drag and drop with the mouse to change the gradient position. Press the button to change the color or remove the control point.'\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t</ControlPointKeyboardMove>\n\t\t);\n\t}\n);\n\nexport default function ControlPoints( {\n\tgradientPickerDomRef,\n\tignoreMarkerPosition,\n\tmarkerPoints,\n\tonChange,\n\tgradientAST,\n\tonStartControlPointChange,\n\tonStopControlPointChange,\n} ) {\n\tconst controlPointMoveState = useRef();\n\n\tconst onMouseMove = ( event ) => {\n\t\tconst relativePosition = getHorizontalRelativeGradientPosition(\n\t\t\tevent.clientX,\n\t\t\tgradientPickerDomRef.current,\n\t\t\tGRADIENT_MARKERS_WIDTH,\n\t\t);\n\t\tconst {\n\t\t\tgradientAST: referenceGradientAST,\n\t\t\tposition,\n\t\t\tsignificantMoveHappened,\n\t\t} = controlPointMoveState.current;\n\t\tif ( ! significantMoveHappened ) {\n\t\t\tconst initialPosition = referenceGradientAST.colorStops[ position ].length.value;\n\t\t\tif ( Math.abs( initialPosition - relativePosition ) >= MINIMUM_SIGNIFICANT_MOVE ) {\n\t\t\t\tcontrolPointMoveState.current.significantMoveHappened = true;\n\t\t\t}\n\t\t}\n\n\t\tif ( ! isControlPointOverlapping( referenceGradientAST, relativePosition, position ) ) {\n\t\t\tonChange(\n\t\t\t\tgetGradientWithPositionAtIndexChanged( referenceGradientAST, position, relativePosition )\n\t\t\t);\n\t\t}\n\t};\n\n\tconst cleanEventListeners = () => {\n\t\tif (\n\t\t\twindow && window.removeEventListener &&\n\t\t\tcontrolPointMoveState.current && controlPointMoveState.current.listenersActivated\n\t\t) {\n\t\t\twindow.removeEventListener( 'mousemove', onMouseMove );\n\t\t\twindow.removeEventListener( 'mouseup', cleanEventListeners );\n\t\t\tonStopControlPointChange();\n\t\t\tcontrolPointMoveState.current.listenersActivated = false;\n\t\t}\n\t};\n\n\tuseEffect( () => {\n\t\treturn () => {\n\t\t\tcleanEventListeners();\n\t\t};\n\t}, [] );\n\n\treturn markerPoints.map(\n\t\t( point, index ) => (\n\t\t\tpoint && ignoreMarkerPosition !== point.positionValue && (\n\t\t\t\t<Dropdown\n\t\t\t\t\tkey={ index }\n\t\t\t\t\tonClose={ onStopControlPointChange }\n\t\t\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t\t\t<ControlPointButton\n\t\t\t\t\t\t\tkey={ index }\n\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tcontrolPointMoveState.current &&\n\t\t\t\t\t\t\t\t\tcontrolPointMoveState.current.significantMoveHappened\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tonStartControlPointChange();\n\t\t\t\t\t\t\t\tonToggle();\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tonMouseDown={ () => {\n\t\t\t\t\t\t\t\tif ( window && window.addEventListener ) {\n\t\t\t\t\t\t\t\t\tcontrolPointMoveState.current = {\n\t\t\t\t\t\t\t\t\t\tgradientAST,\n\t\t\t\t\t\t\t\t\t\tposition: index,\n\t\t\t\t\t\t\t\t\t\tsignificantMoveHappened: false,\n\t\t\t\t\t\t\t\t\t\tlistenersActivated: true,\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tonStartControlPointChange();\n\t\t\t\t\t\t\t\t\twindow.addEventListener( 'mousemove', onMouseMove );\n\t\t\t\t\t\t\t\t\twindow.addEventListener( 'mouseup', cleanEventListeners );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tisOpen={ isOpen }\n\t\t\t\t\t\t\tposition={ point.position }\n\t\t\t\t\t\t\tcolor={ point.color }\n\t\t\t\t\t\t\tonChange={ onChange }\n\t\t\t\t\t\t\tgradientAST={ gradientAST }\n\t\t\t\t\t\t\tgradientIndex={ index }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\trenderContent={ ( { onClose } ) => (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<ColorPicker\n\t\t\t\t\t\t\t\tcolor={ point.color }\n\t\t\t\t\t\t\t\tonChangeComplete={ ( { rgb } ) => {\n\t\t\t\t\t\t\t\t\tonChange(\n\t\t\t\t\t\t\t\t\t\tgetGradientWithColorAtIndexChanged( gradientAST, index, rgb )\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"components-custom-gradient-picker__remove-control-point\"\n\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\tonChange(\n\t\t\t\t\t\t\t\t\t\tgetGradientWithControlPointRemoved( gradientAST, index )\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\tisLink\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ __( 'Remove Control Point' ) }\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\t\t\t\t\tpopoverProps={ COLOR_POPOVER_PROPS }\n\t\t\t\t/>\n\t\t\t)\n\t\t)\n\t);\n}\n"]}