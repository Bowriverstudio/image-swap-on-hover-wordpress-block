import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
import _toConsumableArray from "@babel/runtime/helpers/esm/toConsumableArray";
import { createElement } from "@wordpress/element";

/**
 * WordPress dependencies
 */
import { useState } from '@wordpress/element';
import { __ } from '@wordpress/i18n';
import { withInstanceId } from '@wordpress/compose';
/**
 * Internal dependencies
 */

import Button from '../button';
import RangeControl from '../range-control';
import CustomSelectControl from '../custom-select-control';

function getSelectValueFromFontSize(fontSizes, value) {
  if (value) {
    var fontSizeValue = fontSizes.find(function (font) {
      return font.size === value;
    });
    return fontSizeValue ? fontSizeValue.slug : 'custom';
  }

  return 'normal';
}

function getSelectOptions(optionsArray, disableCustomFontSizes) {
  if (!disableCustomFontSizes) {
    optionsArray = [].concat(_toConsumableArray(optionsArray), [{
      slug: 'custom',
      name: __('Custom')
    }]);
  }

  return optionsArray.map(function (option) {
    return {
      key: option.slug,
      name: option.name,
      style: {
        fontSize: option.size
      }
    };
  });
}

function FontSizePicker(_ref) {
  var fallbackFontSize = _ref.fallbackFontSize,
      _ref$fontSizes = _ref.fontSizes,
      fontSizes = _ref$fontSizes === void 0 ? [] : _ref$fontSizes,
      _ref$disableCustomFon = _ref.disableCustomFontSizes,
      disableCustomFontSizes = _ref$disableCustomFon === void 0 ? false : _ref$disableCustomFon,
      onChange = _ref.onChange,
      value = _ref.value,
      _ref$withSlider = _ref.withSlider,
      withSlider = _ref$withSlider === void 0 ? false : _ref$withSlider,
      instanceId = _ref.instanceId;

  var _useState = useState(getSelectValueFromFontSize(fontSizes, value)),
      _useState2 = _slicedToArray(_useState, 2),
      currentSelectValue = _useState2[0],
      setCurrentSelectValue = _useState2[1];

  if (disableCustomFontSizes && !fontSizes.length) {
    return null;
  }

  var onChangeValue = function onChangeValue(event) {
    var newValue = event.target.value;
    setCurrentSelectValue(getSelectValueFromFontSize(fontSizes, Number(newValue)));

    if (newValue === '') {
      onChange(undefined);
      return;
    }

    onChange(Number(newValue));
  };

  var onSelectChangeValue = function onSelectChangeValue(_ref2) {
    var selectedItem = _ref2.selectedItem;
    setCurrentSelectValue(selectedItem.key);
    onChange(selectedItem.style && selectedItem.style.fontSize);
  };

  var onSliderChangeValue = function onSliderChangeValue(sliderValue) {
    onChange(sliderValue);
    setCurrentSelectValue(getSelectValueFromFontSize(fontSizes, sliderValue));
  };

  var options = getSelectOptions(fontSizes, disableCustomFontSizes);
  var rangeControlNumberId = "components-range-control__number#".concat(instanceId);
  return createElement("fieldset", {
    className: "components-font-size-picker"
  }, createElement("legend", {
    className: "screen-reader-text"
  }, __('Font Size')), createElement("div", {
    className: "components-font-size-picker__controls"
  }, fontSizes.length > 0 && createElement(CustomSelectControl, {
    className: 'components-font-size-picker__select',
    label: __('Preset Size'),
    options: options,
    value: options.find(function (option) {
      return option.key === currentSelectValue;
    }) || options[0],
    onChange: onSelectChangeValue
  }), !withSlider && !disableCustomFontSizes && createElement("div", {
    className: "components-range-control__number-container"
  }, createElement("label", {
    htmlFor: rangeControlNumberId
  }, __('Custom')), createElement("input", {
    id: rangeControlNumberId,
    className: "components-range-control__number",
    type: "number",
    onChange: onChangeValue,
    "aria-label": __('Custom'),
    value: value || ''
  })), createElement(Button, {
    className: "components-color-palette__clear",
    disabled: value === undefined,
    onClick: function onClick() {
      onChange(undefined);
      setCurrentSelectValue(getSelectValueFromFontSize(fontSizes, undefined));
    },
    isSmall: true,
    isDefault: true
  }, __('Reset'))), withSlider && createElement(RangeControl, {
    className: "components-font-size-picker__custom-input",
    label: __('Custom Size'),
    value: value || '',
    initialPosition: fallbackFontSize,
    onChange: onSliderChangeValue,
    min: 12,
    max: 100,
    beforeIcon: "editor-textcolor",
    afterIcon: "editor-textcolor"
  }));
}

export default withInstanceId(FontSizePicker);
//# sourceMappingURL=index.js.map